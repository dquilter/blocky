<!doctype html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<title>Phaser - Making your first game, part 1</title>
	<script type="text/javascript" src="phaser.min.js"></script>
	<style type="text/css">
		body {
			margin: 0;
		}
	</style>
</head>

<body>

	<script type="text/javascript">
		var game = new Phaser.Game(800, 600, Phaser.AUTO, '', {
			preload: preload,
			create: create,
			update: update
		});

		function preload() {
			game.load.image('ground', 'platform.png');
			game.load.image('star', 'star.png');
		}

		function create() {

			//  We're going to be using physics, so enable the Arcade Physics system
			game.physics.startSystem(Phaser.Physics.ARCADE);

			//  The platforms group contains the ground and the 2 ledges we can jump on
			platforms = game.add.group();

			//  We will enable physics for any object that is created in this group
			platforms.enableBody = true;

			// Here we create the ground.
			var ground = platforms.create(0, game.world.height - 64, 'ground');
			//  Scale it to fit the width of the game (the original sprite is 400x32 in size)
			ground.scale.setTo(2, 2);
			//  This stops it from falling away when you jump on it
			ground.body.immovable = true;

			//  Now let's create two ledges
			var ledge = platforms.create(400, 400, 'ground');
			ledge.body.immovable = true;
			
			// Create guard
			guard = game.add.sprite(450, game.world.height - 150, 'star')
			guardObj = new Guard(guard);
			game.physics.arcade.enable(guard);
			guard.body.collideWorldBounds = true;

			// The player and its settings
			player = game.add.sprite(32, game.world.height - 150, 'star');
			//  We need to enable physics on the player
			game.physics.arcade.enable(player);
			//  Player physics properties. Give the little guy a slight bounce.
			player.body.bounce.y = 0.2;
			player.body.gravity.y = 450;
			player.body.collideWorldBounds = true;

			cursors = game.input.keyboard.createCursorKeys();
		}

		function update() {

			//  Collide the player and the stars with the platforms
			game.physics.arcade.collide(player, platforms);
			//  Reset the players velocity (movement)
			player.body.velocity.x = 0;

			if (cursors.left.isDown) {
				//  Move to the left
				player.body.velocity.x = -150;

				player.animations.play('left');
			} else if (cursors.right.isDown) {
				//  Move to the right
				player.body.velocity.x = 150;

				player.animations.play('right');
			} else {
				//  Stand still
				player.animations.stop();

				player.frame = 4;
			}

			//  Allow the player to jump if they are touching the ground.
			if (cursors.up.isDown && player.body.touching.down) {
				player.body.velocity.y = -350;
			}

			//  Collide the guard and the stars with the platforms
			game.physics.arcade.collide(guard, platforms);
			guard.body.velocity.x = 0;
			guardObj.patrol();

		}
		
		function patrol(guard) {
		}
		
		var Guard = function(phaserRef) {
			this.patrolDir = -1;
			this.phaserRef = phaserRef;
			
			this.patrol = function() {
				this.phaserRef.body.velocity.x = 100 * this.patrolDir;
			}
		}
	</script>

</body>

</html>